<section class='torrents-page'>
   <section id='torrents-page-title'>
      <div class="container d-flex flex-row justify-content-between align-items-center">
         <h1 class='py-2 ps-1'>Dashboard</h1>
      </div>
   </section>

   <section id= "torrents-page-body">
      <div class="container">


      <section id="torrent-table-headers" class="d-flex flex-row justify-content-between align-items-center">
         <%- include('partials/torrentsNav') %>

            <div id="throttle" class="btn-group">
               <button class="btn btn-dropdown btn-sm" type="button" id="throttle-dropdown-btn" data-bs-toggle="dropdown" aria-expanded="true">
                   <i class="bi bi-speedometer2"></i>
               </button>

               <ul id="throttle-dropdown" class="dropdown-menu">
                  <section class="d-flex flex-row justify-content-between align-items-center">
                     <h5>Upload Throttle:</h5>
                     <div class="d-flex flex-row justify-content-center align-items-center">
                       <form id='upload-throttle-up' style="display:inline">
                           <input type="hidden" />
                           <button type="submit" class="btn btn-small">
                              <i class="bi bi-chevron-double-up"></i>    
                            </button>
                       </form> 
                       <span id='upload-throttle'><%= `${(upMax / 1000)}` %><small>KB/s</small></span>
                       <form id='upload-throttle-down' style="display:inline">
                           <input type="hidden" />
                           <button type="submit" class="btn btn-sm">
                              <i class="bi bi-chevron-double-down"></i>    
                         </button>
                       </form> 
                     </div>
                  </section>

                  <section class="d-flex flex-row justify-content-between align-items-center">
                     <h5>Download Throttle:</h5>
                     <div class="d-flex flex-row justify-content-center align-items-center">
                       <form id='download-throttle-up' style="display:inline">
                           <input type="hidden" />
                           <button type="submit" class="btn btn-small">
                              <i class="bi bi-chevron-double-up"></i>    
                            </button>
                       </form> 
                       <span id='download-throttle'><%= `${(downMax / 1000)}` %><small>KB/s</small></span>
                       <form id='download-throttle-down' style="display:inline">
                           <input type="hidden" />
                           <button type="submit" class="btn btn-small">
                              <i class="bi bi-chevron-double-down"></i>    
                         </button>
                       </form> 
                     </div>
                  </section>
               </ul>
            </div>


            <button class="btn btn-toucan" data-bs-toggle="modal" data-bs-target="#torrent-upload-modal" type="button">
               <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-plus-circle-fill" viewBox="0 0 16 16">
     <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
   </svg>
            </button>

            <form id="client-toggle" style="display:inline" >
                <input type="hidden" />
              <button type="submit" class="btn">
               <% if (upRate == 0 && downRate == 0) { %>
                 <i class="bi bi-play-fill"></i>
               <% } else { %>
                 <i class='bi bi-pause-fill'></i>
               <% } %>
              </button>
            </form> 
      </section>
         
      <section id='torrent-table'>

           <section id="table">
              <table>

                 <tbody>
                    <% torrentsArray.forEach( torrent => { %>

               <div id="<%= torrent.infoHash %>" 
                  class="<%=torrent.paused ? 'torrent-row paused' : 'torrent-row'; %> container new-torrent-row d-flex flex-row align-items-center justify-content-between mb-3"
                  >
                   <% if (!torrent.done) { %>
                   <div>
                     <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">
                        </span>
                     </div>
                     <%= `${(torrent.progress * 100).toFixed(2)}%` %>
                   </div>
                   <% } else { %>
                     <i class="bi bi-check-circle-fill"></i>
                   <% } %>
                     <h5>
                        <%= torrent.name %>
                     </h5>
                     <div class="btn-group">
                        <button class="btn btn-dropdown btn-sm" type="button" id="torrent-controls" data-bs-toggle="dropdown" data-bs-auto-close="true" aria-expanded="false">
                             <i class="bi bi-sm bi-three-dots-vertical"></i>     
                        </button>
                        <ul class="dropdown-menu" aria-labelledby='torrentControls'>
                          <li>
                           <form class="torrent-toggle menu-item">
                               <button class="torrent-toggle btn" type="submit">
                                 <% if (torrent.paused) { %>
                                   <i class="bi bi-play-circle-fill"></i>
                                 <% } else { %>
                                   <i class='bi bi-pause-circle-fill'></i>
                                 <% } %>
                             </button>
                             Toggle
                           </form> 
                          </li>
                          <li>
                           <div>
                              <button class="dropdown-item btn btn-info btn-torrent-view" data-bs-toggle="modal" data-bs-target="#torrent-upload-modal" type="button">
                                 <i class="bi bi-info-circle-fill"></i>      
                              </button> 
                           </div>
                          </li>
                          <li>
                           <form class="dropdown-item" action="/torrents/<%= torrent.infoHash %>" method="POST" id="delete-from">
                            <input type="hidden" name="_method" value="DELETE">
                            <button type="submit" class="btn btn-small red">
                               <i class="bi bi-trash-fill"></i>
                             </button>
                             Delete
                           </form> 
                          </li>
                        </ul>
                     </div>
               </div>


                    <tr id="<%= torrent.infoHash %>" class="<%=torrent.paused ? 'torrent-row paused' : 'torrent-row'; %>" >
                          <td>
                           <form action="/torrents/<%= torrent.infoHash %>" method="POST" id="delete-from">
                               <input type="hidden" name="_method" value="DELETE">
                               <button type="submit" class="btn btn-small red">
                                  <i class="fas fa-trash trip-delete">x</i>
                             </button>
                           </form> 
                           |
                           <a href='/torrents/download/<%= torrent.infoHash %>'>v</a>
                           |
                           <a href='/torrents/<%= torrent.infoHash %>'>+</a>
                          </td>
                          <td><%= torrent.name %></td>
                          <td><%= torrent.createdBy %></td>
                          <td><%= `${(torrent.uploadSpeed / 1000).toFixed(2)}` %> KB/s</td>
                          <td><%= `${(torrent.downloadSpeed / 1000).toFixed(2)}` %> KB/s</td>
                          <td><%= torrent.numPeers %></td>
                          <td class="torrent-toggle">
                           <form class="torrent-toggle">
                               <button class="torrent-toggle btn" type="submit">
                                 <% if (torrent.paused) { %>
                                   <i class="bi bi-play-circle-fill"></i>
                                 <% } else { %>
                                   <i class='bi bi-pause-circle-fill'></i>
                                 <% } %>
                             </button>
                           </form> 
                          </td>
                        </tr>
                     
                     <% }) %>    

                 </tbody>
              </table>
           </section>
      </div>
   </section>
   <div class="fixed-bottom mb-4 ms-1">
            <span id="client-rate"><%= `${(upRate / 1000).toFixed(2)}` %>/<%= `${(downRate / 1000).toFixed(2)}` %><small>KB/s</small></span>
   </div>
</section>

<%- include('partials/uploadModal') %>
